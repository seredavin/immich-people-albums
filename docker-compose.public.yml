services:
  # Docker Compose для использования готового образа из GitHub Container Registry
  # Не требует сборки образа локально - использует опубликованный образ

  immich-people-albums:
    # Используем готовый образ из GitHub Container Registry
    image: ghcr.io/seredavin/immich-people-albums:latest
    # Или используйте конкретную версию:
    # image: ghcr.io/seredavin/immich-people-albums:v1.0.0
    
    container_name: immich-people-albums
    restart: unless-stopped
    
    volumes:
      # Монтируем конфигурацию
      - ./config.yaml:/config/config.yaml
      # Монтируем логи (опционально)
      - ./logs:/app/logs
    
    environment:
      - CONFIG_PATH=/config/config.yaml
      # Если Immich на том же хосте, можно использовать host.docker.internal
      # или имя сервиса из docker-compose Immich
      - TZ=Europe/Moscow  # Установите свой часовой пояс
      # Режим работы: "once" (один раз) или "cron" (по расписанию)
      # Если не указано, запускается один раз и завершается
      - RUN_MODE=${RUN_MODE:-once}
      # Расписание для cron (только если RUN_MODE=cron)
      # Формат: "0 2 * * *" (каждый день в 2:00)
      - CRON_SCHEDULE=${CRON_SCHEDULE:-0 2 * * *}
    
    networks:
      - immich-network  # Используйте сеть вашего Immich, если он в Docker
    
    # Если RUN_MODE=cron, контейнер будет запускать скрипт по расписанию
    # Если RUN_MODE=once, контейнер запустит скрипт один раз и завершится
    # Если RUN_MODE не указан, поведение по умолчанию - один раз

networks:
  immich-network:
    external: true  # Используйте существующую сеть Immich
    # Или создайте новую:
    # external: false
